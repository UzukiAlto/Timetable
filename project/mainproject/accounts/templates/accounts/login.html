<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BlogSite</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <script src="https://apis.google.com/js/platform.js" async defer></script>
  <meta name="google-signin-client_id" content="845944346746-uvhtfg0gosl5e352ckh4et9vrp2k94lg.apps.googleusercontent.com">

</head>
<body>

    <div class="container d-flex justify-content-center align-items-center" style="min-height: 80vh;">
       <div class="card shadow p-4 rounded" style="width: 100%; max-width: 400px;">
             <h2>ログイン | SyncSchedule</h2>
            <form method="post" >
                {% csrf_token %}
                {{ form.as_p }}
                <button class="btn btn-secondary" type="submit">ログイン</button>
            </form>
       </div>
    </div>
    <div class="g-signin2" data-onsuccess="onSignIn"></div> <!-- google login button -->
        <script>
        function onSignIn(googleUser) {
            var id_token = googleUser.getAuthResponse().id_token;
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '{% url "google_login" %}');
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.setRequestHeader('X-CSRFToken', '{{ csrf_token }}');
            xhr.onload = function() {
                if (xhr.status === 200) {
                    window.location.href = '{% url "app:index" %}';
                } else {
                    console.log('Login failed: ' + xhr.responseText);
                }
            };
            xhr.send('idtoken=' + id_token);
        }
    </script>
   <nav class="navbar bg-body-tertiary">
        <div class="container">
            <a class="navbar-brand" href="{% url 'app:index' %}">SyncSchedule</a>
 
            <ul class="navbar-nav  flex-row gap-3">
                {% if user.is_authenticated  %}
                <li class="nav-item">
                    <form action="{% url 'logout' %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-link nav-link">ログアウト | SyncSchedule</button>
                    </form>
                </li>
                
                {% else %}
                <li class="nav-item"><a class="nav-link" href="{% url 'signup' %}">アカウント登録</a></li>
                {% endif %}
            </ul>
        </div>
    </nav>
</body>
</html>